<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Notion Image Automator</title>
    <style>
        body { font-family: sans-serif; padding: 30px; line-height: 1.6; max-width: 500px; margin: auto; }
        .card { border: 1px solid #eee; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #000; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        #log { margin-top: 15px; font-size: 12px; color: #666; word-break: break-all; }
    </style>
</head>
<body>
    <div class="card">
        <h3>ğŸš€ ì´ë¯¸ì§€ ìë™ ë³€í™˜ & ë…¸ì…˜ ì „ì†¡</h3>
        <input type="text" id="targetPage" placeholder="ì´ë¯¸ì§€ë¥¼ ë„£ì„ ë…¸ì…˜ í˜ì´ì§€ ì£¼ì†Œ">
        <input type="text" id="rawImg" placeholder="ë„¤ì´ë²„/ì¹´ì¹´ì˜¤ ì´ë¯¸ì§€ ì£¼ì†Œ ë¶™ì—¬ë„£ê¸°">
        
        <button onclick="process()">ë³€í™˜ í›„ ë…¸ì…˜ìœ¼ë¡œ ì „ì†¡</button>
        
        <div id="log"></div>
    </div>

    <script>
        async function process() {
            const pageUrl = document.getElementById('targetPage').value;
            const rawImg = document.getElementById('rawImg').value;
            const log = document.getElementById('log');
            const GAS_URL = "ì—¬ê¸°ì—_ì•±ìŠ¤_ìŠ¤í¬ë¦½íŠ¸_ë°°í¬_URL_ì…ë ¥";

            if(!pageUrl || !rawImg) return alert("ë‘ ì£¼ì†Œ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");

            // 1. í˜ì´ì§€ ID ì¶”ì¶œ
            const pageId = pageUrl.split("/").pop().split("?")[0].split("-").pop();
            
            // 2. 1ì°¨ ë³€í™˜: ë…¸ì…˜ ìš°íšŒìš© êµ¬ê¸€ í”„ë¡ì‹œ ì£¼ì†Œ ìƒì„±
            const proxiedUrl = `https://images-opensocial.googleusercontent.com/gadgets/proxy?container=focus&refresh=604800&url=${encodeURIComponent(rawImg)}&.jpg`;

            log.innerText = "â³ ë³€í™˜ëœ ì£¼ì†Œë¡œ ë…¸ì…˜ ì—…ë°ì´íŠ¸ ì¤‘...";

            try {
                // 3. ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ë¡œ ìë™ ì „ì†¡
                const res = await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify({ pageId, proxiedUrl })
                });
                
                if(res.ok) {
                    log.innerHTML = `âœ… ì „ì†¡ ì„±ê³µ!<br><b>ë³€í™˜ ì£¼ì†Œ:</b> ${proxiedUrl}`;
                    document.getElementById('rawImg').value = ""; // ì…ë ¥ì°½ ë¹„ìš°ê¸°
                }
            } catch (e) {
                log.innerText = "âŒ ì‹¤íŒ¨: " + e;
            }
        }
    </script>
</body>
</html>
